!function(){"use strict";var e={d:function(n,o){for(var t in o)e.o(o,t)&&!e.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:o[t]})},o:function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}},n={};e.d(n,{default:function(){return d}});var o=Object.freeze({restaurant:new window.L.Icon({iconUrl:"assets/img/marker/restaurant.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),bar:new window.L.Icon({iconUrl:"assets/img/marker/bar.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),cellar:new window.L.Icon({iconUrl:"assets/img/marker/cellar.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),grocery:new window.L.Icon({iconUrl:"assets/img/marker/grocery.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),foot:new window.L.Icon({iconUrl:"assets/img/marker/foot.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),rugby:new window.L.Icon({iconUrl:"assets/img/marker/rugby.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),pingpong:new window.L.Icon({iconUrl:"assets/img/marker/pingpong.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),bocce:new window.L.Icon({iconUrl:"assets/img/marker/bocce.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),tennis:new window.L.Icon({iconUrl:"assets/img/marker/tennis.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),bakery:new window.L.Icon({iconUrl:"assets/img/marker/bread.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),book:new window.L.Icon({iconUrl:"assets/img/marker/book.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),landmark:new window.L.Icon({iconUrl:"assets/img/marker/landmark.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),church:new window.L.Icon({iconUrl:"assets/img/marker/church.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),garden:new window.L.Icon({iconUrl:"assets/img/marker/garden.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),car:new window.L.Icon({iconUrl:"assets/img/marker/car.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),train:new window.L.Icon({iconUrl:"assets/img/marker/train.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),animal:new window.L.Icon({iconUrl:"assets/img/marker/animal.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),mail:new window.L.Icon({iconUrl:"assets/img/marker/mail.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),park:new window.L.Icon({iconUrl:"assets/img/marker/park.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),recycle:new window.L.Icon({iconUrl:"assets/img/marker/recycle.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),administration:new window.L.Icon({iconUrl:"assets/img/marker/administration.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),school:new window.L.Icon({iconUrl:"assets/img/marker/school.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),user:new window.L.Icon({iconUrl:"assets/img/marker/user.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/img/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]})}),t=function(e,n){var o=Math.pow(10,n||0);return Math.round(e*o)/o},r={CCDH_CENTER:{LAT:48.53183906441962,LNG:2.053756713867188},CCDH_CITIES:["BRX","COR","DRD","LFR","LGR","RIC","ROV","SCD","SER","STC","VSG"],MAP_BOUNDS:window.L.latLngBounds(window.L.latLng(48.679400715963894,1.7390606689453127),window.L.latLng(48.38439074151866,2.34339599609375)),OSM_LAYER:window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',maxZoom:19,minZoom:12}),ESRI_LAYER:window.L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:'&copy; <a href="https://www.arcgis.com/home/item.html?id=10df2279f9684e4a9f6a7f08febac2a9">Esri Imagery</a>',maxZoom:19,minZoom:12}),getDistanceBetweenCoords:function(e,n){var o=e[1]*Math.PI/180,t=e[0]*Math.PI/180,r=n[1]*Math.PI/180,a=n[0]*Math.PI/180,i=a-t,s=r-o,c=Math.pow(Math.sin(i/2),2)+Math.cos(t)*Math.cos(a)*Math.pow(Math.sin(s/2),2);return 2*Math.asin(Math.sqrt(c))*6371*1e3},convertDistanceToString:function(e){return e>1e3?"".concat(t(e/1e3,2),"km"):"".concat(t(e,2),"m")},buildDistanceETA:function(e){var n,o=0;n=(o=e>5e4?e/1e5*60:e>1e4?e/6e4*60:e/3e4*60)%1,o=(o=Math.floor(o))>60?"".concat(Math.floor(o/60),"h ").concat(o%60,"m"):"".concat(o,"m");var r=e/5e3*60,a=r%1;return r=(r=Math.floor(r))>60?"".concat(Math.floor(r/60),"h ").concat(r%60,"m"):"".concat(r,"m"),{car:"".concat(o," ").concat(Math.floor(100*t(n/100*60,2)),"s"),walk:"".concat(r," ").concat(Math.floor(100*t(a/100*60,2)),"s")}},precisionRound:t};function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(e,n){for(var o=0;o<n.length;o++){var t=n[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,(void 0,r=function(e,n){if("object"!==a(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var t=o.call(e,"string");if("object"!==a(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t.key),"symbol"===a(r)?r:String(r)),t)}var r}var s=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.targetId,this._map=null,this._marks={},this._polygons=[],this._layers={Carte:null,Satellite:null},this._init(),this._events()}var n,t;return n=e,(t=[{key:"_init",value:function(){this._map=window.L.map(this._id,{zoomControl:!1}).setView([r.CCDH_CENTER.LAT,r.CCDH_CENTER.LNG],12),window.L.control.scale().addTo(this._map),this._map.setMaxBounds(r.MAP_BOUNDS),this._layers.Carte=r.OSM_LAYER,this._layers.Satellite=r.ESRI_LAYER,this._layers.Carte.addTo(this._map),window.L.control.layers(this._layers,{},{position:"bottomright"}).addTo(this._map)}},{key:"_events",value:function(){var e=this;this._map.on("click",this._mapClicked.bind(this)),this._map.on("drag",(function(){e._map.panInsideBounds(r.MAP_BOUNDS,{animate:!0})}))}},{key:"_mapClicked",value:function(e){console.log(e.latlng,JSON.stringify(e.latlng.lat+", "+e.latlng.lng))}},{key:"drawUserMarker",value:function(){window.dx.user.marker?window.dx.user.marker.setLatLng(window.dx.user):(window.dx.user.marker=window.L.marker([window.dx.user.lat,window.dx.user.lng],{icon:o.user}),window.dx.user.marker.addTo(this._map))}},{key:"addMark",value:function(e,n){var t=this,r=e.type.split("/"),a=e.type;r.length>1&&(a="".concat(r[0]).concat(r[1]));var i=window.L.marker([e.lat,e.lng],{icon:o[a]}).on("click",(function(){t._map.flyTo([e.lat,e.lng],18)}));if(i.bindPopup(n(e)),i.addTo(this._map),r.length>1)for(var s=0;s<r.length;++s)this._marks[r[s]]||(this._marks[r[s]]=[]),this._marks[r[s]].push(i);else this._marks[a]||(this._marks[a]=[]),this._marks[a].push(i)}},{key:"addPolygon",value:function(e){this._polygons.push(window.L.polygon(e).addTo(this._map))}}])&&i(n.prototype,t),Object.defineProperty(n,"prototype",{writable:!1}),e}();function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(e,n){for(var o=0;o<n.length;o++){var t=n[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,(void 0,r=function(e,n){if("object"!==c(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var t=o.call(e,"string");if("object"!==c(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t.key),"symbol"===c(r)?r:String(r)),t)}var r}var d=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this._map=null,this._layers={},this._data={},this._user={geolocationAllowed:!1,lat:r.HOME_LAT,lng:r.HOME_LNG,accuracy:0,marker:null},this._initGeolocation().then(this._initMap.bind(this)).then(this._initEvents.bind(this)).then(this._fetchMarkers.bind(this)).then((function(){console.log("we are done")}))}var n,o;return n=e,(o=[{key:"_initGeolocation",value:function(){var e=this;return new Promise((function(n){if("geolocation"in navigator){var o={enableHighAccuracy:!0,maximumAge:1e3,timeout:900};navigator.geolocation.getCurrentPosition(e._positionInitialized.bind(e),null,o),e._watchId=navigator.geolocation.watchPosition(e._positionUpdate.bind(e),null,o)}n()}))}},{key:"_initMap",value:function(){var e=this;return new Promise((function(n){e._map=new s({targetId:"sarmates-land"}),n()}))}},{key:"_initEvents",value:function(){var e=this;return new Promise((function(n){document.getElementById("modal-overlay").addEventListener("click",e.closeModal.bind(e)),n()}))}},{key:"_fetchMarkers",value:function(){var e=this;return new Promise((function(n){for(var o=[],t=function(n){o.push(new Promise((function(o){fetch("./assets/json/".concat(r.CCDH_CITIES[n],".json")).then((function(t){t.json().then((function(t){e._data[r.CCDH_CITIES[n]]=t,requestAnimationFrame((function(){e._buildPolygons(e._data[r.CCDH_CITIES[n]].bounds).then((function(){requestAnimationFrame((function(){e._buildMarkers(e._data[r.CCDH_CITIES[n]].pois).then(o)}))}))}))})).catch(o)})).catch(o)})))},a=0;a<r.CCDH_CITIES.length;++a)t(a);Promise.all(o).then(n)}))}},{key:"_buildMarkers",value:function(e){var n=this;return new Promise((function(o){for(var t=Object.keys(e),r=0;r<t.length;++r)for(var a=0;a<e[t[r]].length;++a)n._map.addMark(e[t[r]][a],n._createMarkerPopup.bind(n));o()}))}},{key:"_buildPolygons",value:function(e){var n=this;return new Promise((function(o){n._map.addPolygon(e),o()}))}},{key:"_positionInitialized",value:function(){this._user.geolocationAllowed=!0}},{key:"_positionUpdate",value:function(e){!0===this._user.geolocationAllowed&&(this._user.lat=e.coords.latitude,this._user.lng=e.coords.longitude,this._user.accuracy=e.coords.accuracy,this._map&&this._map.drawUserMarker())}},{key:"_createMarkerPopup",value:function(e){var n=document.createElement("DIV"),o=document.createElement("H3"),t=document.createElement("I"),r=document.createElement("I"),a=document.createElement("A"),i=document.createElement("A"),s=document.createElement("P"),c=document.createElement("A");n.classList.add("marker-popup"),o.innerHTML=e.name,t.innerHTML=e.address,r.innerHTML=e.town,a.href="tel:".concat(e.phone),a.innerHTML='<img src="./assets/img/icon/phone.svg">'.concat(e.phone),i.href=e.website,i.innerHTML='<img src="./assets/img/icon/web.svg">Consulter le site',i.setAttribute("rel","noopener noreferrer"),i.setAttribute("target","_blank"),s.innerHTML=e.info,c.href="geo:".concat(e.lat,",").concat(e.lng),c.innerHTML='<img src="./assets/img/icon/pin.svg">Ouvrir dans le GPS',n.appendChild(o),n.appendChild(t),n.appendChild(r);var l=this._markerOpenedState(e.timetable);n.appendChild(l);for(var d=!0,h=0;h<e.timetable.length;++h)if(!0===e.timetable[h].isOpen){d=!1;break}return e.timetable.length>0&&!1===d&&l.addEventListener("click",this._timetbaleModal.bind(this,e)),""!==e.info&&n.appendChild(s),""!==e.phone&&n.appendChild(a),""!==e.website&&n.appendChild(i),n.appendChild(c),n}},{key:"_markerOpenedState",value:function(e){var n=document.createElement("DIV"),o=document.createElement("H5"),t=document.createElement("I");if(n.classList.add("marker-opened"),n.appendChild(o),n.appendChild(t),e.length){for(var r=!0,a=0;a<e.length;++a)if(!0===e[a].isOpen){r=!1;break}!0===r?this._markerIsClosed(n,!0):(this._checkTime(e,n),setInterval(this._checkTime.bind(this,e,n),6e4))}else this._markerIsOpened(n,!0);return n}},{key:"_checkTime",value:function(e,n){var o=new Date,t=o.getHours(),r=o.getMinutes();r<10&&(r="0".concat(r));var a=o.getDay()-1,i=parseInt("".concat(e[a].open.h).concat(e[a].open.m)),s=parseInt("".concat(e[a].close.h).concat(e[a].close.m)),c=parseInt("".concat(t).concat(r));if(e[a].isOpen&&isNaN(i))this._markerIsOpened(n,!0);else if(e[a].isOpen&&c>=i&&c<s)if(e[a].break.hasBreak){var l=parseInt("".concat(e[a].break.end.h).concat(e[a].break.end.m));c>=parseInt("".concat(e[a].break.start.h).concat(e[a].break.start.m))&&c<l?this._markerIsClosed(n):this._markerIsOpened(n)}else this._markerIsOpened(n);else this._markerIsClosed(n)}},{key:"_markerIsOpened",value:function(e,n){e.firstChild.innerHTML="Ouvert",e.lastChild.innerHTML=!0===n?"Toujours ouvert":"Voir les horaires",e.classList.add("opened")}},{key:"_markerIsClosed",value:function(e,n){e.firstChild.innerHTML="Fermé",e.lastChild.innerHTML=n?"Toujours fermé":"Voir les horaires",e.classList.remove("opened")}},{key:"_timetbaleModal",value:function(e){var n=this;this.fetchModal("timetablemodal").then((function(o){o.querySelector("#mark-name").innerHTML=e.name,o.querySelector("#mark-address").innerHTML="".concat(e.address,", ").concat(e.town);var t=r.getDistanceBetweenCoords([e.lat,e.lng],[n._user.lat,n._user.lng]);o.querySelector("#mark-distance").innerHTML="Vous ètes à environ ".concat(r.convertDistanceToString(t)," de <b>").concat(e.name,"</b> à vol d'oiseau");var a=r.buildDistanceETA(t);o.querySelector("#mark-eta").innerHTML="Ce qui représente environ ".concat(a.car," en voiture, ou ").concat(a.walk," à pied."),o.querySelector("#mark-state").appendChild(n._markerOpenedState(e.timetable));for(var i=(new Date).getDay()-1,s=0;s<e.timetable.length;++s){var c=o.querySelector("#timetable").children[s];if(!0===e.timetable[s].isOpen){var l=c.lastElementChild.firstElementChild,d=c.lastElementChild.lastElementChild;e.timetable[s].break&&!0===e.timetable[s].break.hasBreak?(l.innerHTML="<p>".concat(e.timetable[s].open.h,":").concat(e.timetable[s].open.m," ‒ ").concat(e.timetable[s].break.start.h,":").concat(e.timetable[s].break.start.m,"</p>"),l.classList.add("filled"),l.classList.add("splited"),d.innerHTML="<p>".concat(e.timetable[s].break.end.h,":").concat(e.timetable[s].break.end.m," ‒ ").concat(e.timetable[s].close.h,":").concat(e.timetable[s].close.m,"</p>"),d.classList.add("filled"),d.classList.add("splited")):e.timetable[s].open.h&&e.timetable[s].close.h?(l.innerHTML="<p>".concat(e.timetable[s].open.h,":").concat(e.timetable[s].open.m,"</p>"),l.classList.add("filled"),d.innerHTML="<p>".concat(e.timetable[s].close.h,":").concat(e.timetable[s].close.m,"</p>"),d.classList.add("filled")):(l.innerHTML="<p>00:00</p>",l.classList.add("filled"),d.innerHTML="<p>24:00</p>",d.classList.add("filled"))}else c.lastElementChild.innerHTML='<div class="closed"><p>Fermé</p></div>';s===i&&c.classList.add("today")}document.getElementById("modal-overlay").appendChild(o),document.getElementById("modal-overlay").style.display="flex",setTimeout((function(){return document.getElementById("modal-overlay").style.opacity=1}),50)}))}},{key:"fetchModal",value:function(e){return new Promise((function(n){fetch("./assets/html/".concat(e,".html")).then((function(e){e.text().then((function(e){n(document.createRange().createContextualFragment(e))}))}))}))}},{key:"closeModal",value:function(e,n){!0!==n&&"modal-overlay"!==e.target.id&&-1===e.target.id.indexOf("close")||(document.getElementById("modal-overlay").style.opacity=0,setTimeout((function(){document.getElementById("modal-overlay").style.display="none",document.getElementById("modal-overlay").innerHTML=""}),300))}},{key:"user",get:function(){return this._user}}])&&l(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),e}();window.DourdannaisExplore=n.default}();